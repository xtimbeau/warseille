---
author:
  - name: Maxime Parodi
  - name: Xavier Timbeau 
  - name: Scotia Hille
---

# un niv1

dsflkjfds

```{r init, include=FALSE, cache=FALSE, eval=TRUE}
uu <- ofce::init_qmd()
version <- bd_read("version_aa")
library(paletteer)

```

```{r}
legend_h <- list(
  theme_ofce_void(), 
  theme(
    legend.position = "bottom",
    legend.box.spacing = unit(3, "pt"),
    legend.title = marquee::element_marquee(vjust=1.2, margin = margin(t=0, b=0, r=6)),
    legend.text = marquee::element_marquee(size = rel(0.6), margin = margin(t=1, b=1), width = NULL, hjust=0.5),
    legend.text.position = "bottom", 
    legend.key.spacing.x = unit(1, "pt"),
    legend.key.height = unit(6, "pt") ) )

vqh <- bd_read("vqh")

temps_tc <- set_names(c("7m tc/w", "10m tc/w", "15m tc/w"), c("7m. marche/TC", "10m. marche/TC", "15m. marche/TC"))
commerces <- set_names(c("alim", "comm", "sante", "sortie"), c("Alimentaire", "Autres commerces", "Santé humaine", "Sorties"))

plots <- map(commerces, \(.type) {
  map(temps_tc, \(.temps){
    data <- vqh |> 
      filter(type == .type) |> 
      filter(temps == .temps) |> 
      select(idINS = fromidINS, wqse) |> 
      r3035::sidINS2sf() 
    ggplot(data)+
      geom_sf(
        mapping= aes(fill = factor(wqse)), col="white", linewidth = 0.01) + 
      scale_fill_paletteer_d("fishualize::Bodianus_rufus", direction=1, 
                             name = glue("Proximité {.type} : "), label = c("faible", "", "", "", "élevée"))+
      legend_h + 
      guides(fill = guide_legend(nrow=1))+
      ofce::ofce_caption(
        source=glue("C200, OSM, Fichiers fonciers, version {version}"),
        note ="L'indicateur de proximité aux aménités combine les surfaces commerciales ou de services dans un rayon de 15 minutes de marche ou de transport en commun avec une mesure de la diversité des commerces ou services accessibles. Il est décliné selon 4 grandes catégories (ici {.type})." |> glue())
  })
})


```


```{r, results="asis"}
#| label: fig-proximite
#| fig-cap: "Proximité aux aménités"

tabsetize2(plots)

```